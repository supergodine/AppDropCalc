<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Configura√ß√£o de URLs</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-item { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
    </style>
</head>
<body>
    <h1>üîß Teste de Configura√ß√£o de URLs</h1>
    
    <div id="results"></div>
    
    <button onclick="testConfiguration()">üß™ Testar Configura√ß√£o</button>
    <button onclick="testLogin()">üîê Testar Login</button>
    
    <script type="module">
        // Simular import da configura√ß√£o
        const API_CONFIG = {
            getBaseURL() {
                // Em desenvolvimento: localhost
                if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                    return 'http://localhost:3001';
                }
                
                // Em produ√ß√£o: Railway
                return 'https://appdropcalc.onrender.com';
                // return 'https://appdropcalc.onrender.com'; // Render
            },

            get auth() {
                const base = this.getBaseURL();
                return {
                    login: `${base}/auth/login`,
                    signup: `${base}/auth/signup`,
                    refresh: `${base}/auth/refresh`,
                    logout: `${base}/auth/logout`,
                    profile: `${base}/auth/profile`,
                };
            }
        };

        function addResult(type, title, content) {
            const div = document.createElement('div');
            div.className = `test-item ${type}`;
            div.innerHTML = `<strong>${title}</strong><br>${content}`;
            document.getElementById('results').appendChild(div);
        }

        window.testConfiguration = function() {
            document.getElementById('results').innerHTML = '';
            
            addResult('info', 'üåç Ambiente Detectado', 
                `Hostname: ${location.hostname}<br>
                 Protocol: ${location.protocol}<br>
                 IsDev: ${location.hostname === 'localhost' || location.hostname === '127.0.0.1'}`);
            
            const baseURL = API_CONFIG.getBaseURL();
            addResult('info', 'üîó URL Base Configurada', baseURL);
            
            addResult('info', 'üîê URLs de Autentica√ß√£o', 
                `Login: ${API_CONFIG.auth.login}<br>
                 Signup: ${API_CONFIG.auth.signup}<br>
                 Profile: ${API_CONFIG.auth.profile}`);
            
            // Verificar se h√° URLs problem√°ticas
            const problematicPatterns = [
                'localhost:3002',
                'vercel.app:3002',
                'http://app-drop-calc',
                'https://app-drop-calc-matcqzw7v.vercel.app:3002'
            ];
            
            let foundProblems = false;
            problematicPatterns.forEach(pattern => {
                if (baseURL.includes(pattern) || 
                    API_CONFIG.auth.login.includes(pattern) ||
                    API_CONFIG.auth.signup.includes(pattern)) {
                    addResult('error', 'üö® URL Problem√°tica Detectada', 
                        `Padr√£o problem√°tico encontrado: ${pattern}`);
                    foundProblems = true;
                }
            });
            
            if (!foundProblems) {
                addResult('success', '‚úÖ Configura√ß√£o OK', 
                    'Nenhuma URL problem√°tica detectada!');
            }
        };

        window.testLogin = async function() {
            try {
                const loginUrl = API_CONFIG.auth.login;
                addResult('info', 'üß™ Testando Conectividade', `Tentando conectar com: ${loginUrl}`);
                
                const response = await fetch(loginUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        email: 'test@test.com', 
                        password: 'wrongpassword' 
                    })
                });
                
                addResult('success', '‚úÖ Conectividade OK', 
                    `Status: ${response.status}<br>
                     URL usada: ${loginUrl}<br>
                     Resposta recebida (esperado 401 para credenciais inv√°lidas)`);
                
            } catch (error) {
                addResult('error', '‚ùå Erro de Conectividade', 
                    `Erro: ${error.message}<br>
                     URL tentativa: ${API_CONFIG.auth.login}<br>
                     Verifique se o backend est√° rodando`);
            }
        };

        // Testar automaticamente ao carregar
        testConfiguration();
    </script>
</body>
</html>