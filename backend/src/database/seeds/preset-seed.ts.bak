import { DataSource } from 'typeorm';
import { PresetPlatform, PlatformType } from '../../modules/presets/entities/preset-platform.entity';
import { Gateway, GatewayType } from '../../modules/presets/entities/gateway.entity';

export async function seedPresets(dataSource: DataSource) {
  const platformRepository = dataSource.getRepository(PresetPlatform);
  const gatewayRepository = dataSource.getRepository(Gateway);

  console.log('üå± Criando presets de plataformas...');

  // Plataformas E-commerce Brasileiras
  const platforms = [
    {
      name: 'Nuvemshop',
      slug: 'nuvemshop',
      description: 'Plataforma brasileira l√≠der em e-commerce para PMEs',
      type: PlatformType.ECOMMERCE,
      feePercent: 2.0,
      fixedFee: 0.49,
      currency: 'BRL',
      supportedCountries: ['BR', 'AR', 'MX'],
      websiteUrl: 'https://www.nuvemshop.com.br',
      logoUrl: 'https://cdn.nuvemshop.com.br/logo.png',
    },
    {
      name: 'Shopify',
      slug: 'shopify',
      description: 'Plataforma global de e-commerce com presen√ßa no Brasil',
      type: PlatformType.ECOMMERCE,
      feePercent: 2.9,
      fixedFee: 0.30,
      currency: 'BRL',
      supportedCountries: ['BR', 'US', 'CA', 'GB', 'AU'],
      websiteUrl: 'https://www.shopify.com.br',
      logoUrl: 'https://cdn.shopify.com/logo.png',
    },
    {
      name: 'WooCommerce',
      slug: 'woocommerce',
      description: 'Plugin WordPress gratuito - taxas dependem do gateway escolhido',
      type: PlatformType.ECOMMERCE,
      feePercent: 0.0,
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR', 'US', 'GB', 'CA', 'AU', 'DE', 'FR'],
      websiteUrl: 'https://woocommerce.com',
      logoUrl: 'https://woocommerce.com/logo.png',
    },
    {
      name: 'Mercado Livre',
      slug: 'mercadolivre',
      description: 'Maior marketplace da Am√©rica Latina',
      type: PlatformType.MARKETPLACE,
      feePercent: 16.0, // Taxa m√©dia incluindo comiss√£o + an√∫ncio
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR', 'AR', 'MX', 'CO', 'CL', 'UY'],
      websiteUrl: 'https://www.mercadolivre.com.br',
      logoUrl: 'https://http2.mlstatic.com/frontend-assets/ml-web-navigation/ui-navigation/6.6.92/mercadolibre/logo_large_25years_v2.png',
      additionalFees: {
        categoryFees: {
          'Eletr√¥nicos': 12.0,
          'Roupas e Acess√≥rios': 13.0,
          'Casa e Jardim': 14.0,
          'Esportes e Fitness': 15.0,
        },
      },
    },
    {
      name: 'Amazon Brasil',
      slug: 'amazon-br',
      description: 'Marketplace global com opera√ß√£o no Brasil',
      type: PlatformType.MARKETPLACE,
      feePercent: 15.0, // Taxa m√©dia de refer√™ncia
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR'],
      websiteUrl: 'https://sell.amazon.com.br',
      logoUrl: 'https://m.media-amazon.com/images/G/32/gc/designs/livepreview/amazon_logo_500500_noto_email_v2016_us-main._CB468775337_.png',
    },
    {
      name: 'Americanas Marketplace',
      slug: 'americanas',
      description: 'Marketplace da Americanas - B2W Digital',
      type: PlatformType.MARKETPLACE,
      feePercent: 18.0,
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR'],
      websiteUrl: 'https://marketplace.americanas.com',
    },
    {
      name: 'Magazine Luiza',
      slug: 'magalu',
      description: 'Marketplace do Magazine Luiza',
      type: PlatformType.MARKETPLACE,
      feePercent: 17.0,
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR'],
      websiteUrl: 'https://parceiros.magazineluiza.com.br',
    },
    {
      name: 'Facebook/Instagram Shop',
      slug: 'facebook-shop',
      description: 'Vendas atrav√©s do Facebook e Instagram',
      type: PlatformType.SOCIAL,
      feePercent: 5.0,
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR', 'US', 'GB', 'CA', 'AU'],
      websiteUrl: 'https://www.facebook.com/business/shops',
    },
  ];

  // Salvar plataformas
  for (const platformData of platforms) {
    const existing = await platformRepository.findOne({
      where: { slug: platformData.slug },
    });

    if (!existing) {
      const platform = platformRepository.create(platformData);
      await platformRepository.save(platform);
      console.log(`‚úÖ Plataforma criada: ${platformData.name}`);
    }
  }

  console.log('üå± Criando presets de gateways...');

  // Gateways de Pagamento Brasileiros
  const gateways = [
    {
      name: 'Mercado Pago',
      slug: 'mercadopago',
      description: 'Gateway oficial do Mercado Livre - l√≠der no Brasil',
      primaryType: GatewayType.CREDIT_CARD,
      supportedTypes: [
        GatewayType.CREDIT_CARD,
        GatewayType.DEBIT_CARD,
        GatewayType.PIX,
        GatewayType.BOLETO,
      ],
      feePercent: 4.99,
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR', 'AR', 'MX', 'CL', 'CO', 'UY', 'PE'],
      supportedCurrencies: ['BRL', 'ARS', 'MXN', 'CLP', 'COP', 'UYU', 'PEN'],
      websiteUrl: 'https://www.mercadopago.com.br',
      logoUrl: 'https://http2.mlstatic.com/storage/logos-api-admin/a5f047d0-9be0-11ec-aad4-c3381f368aaf-m.svg',
      feeStructure: {
        creditCard: { percent: 4.99, fixed: 0.0 },
        debitCard: { percent: 3.99, fixed: 0.0 },
        pix: { percent: 0.99, fixed: 0.0 },
        boleto: { percent: 3.49, fixed: 0.0 },
      },
      processingTimes: {
        creditCard: 'Instant√¢neo',
        debitCard: 'Instant√¢neo',
        pix: 'Instant√¢neo',
        boleto: '1-3 dias √∫teis',
        settlement: {
          creditCard: 'D+14 ou D+30',
          debitCard: 'D+1',
          pix: 'D+1',
          boleto: 'D+2',
        },
      },
    },
    {
      name: 'PagSeguro',
      slug: 'pagseguro',
      description: 'Gateway brasileiro do UOL - forte no mercado nacional',
      primaryType: GatewayType.CREDIT_CARD,
      supportedTypes: [
        GatewayType.CREDIT_CARD,
        GatewayType.DEBIT_CARD,
        GatewayType.PIX,
        GatewayType.BOLETO,
      ],
      feePercent: 4.99,
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR'],
      supportedCurrencies: ['BRL'],
      websiteUrl: 'https://pagseguro.uol.com.br',
      logoUrl: 'https://stc.pagseguro.uol.com.br/public/img/ps-logo.png',
      feeStructure: {
        creditCard: { percent: 4.99, fixed: 0.0 },
        debitCard: { percent: 3.99, fixed: 0.0 },
        pix: { percent: 0.99, fixed: 0.0 },
        boleto: { percent: 3.49, fixed: 0.0 },
      },
    },
    {
      name: 'Stripe',
      slug: 'stripe',
      description: 'Gateway global com opera√ß√£o no Brasil',
      primaryType: GatewayType.CREDIT_CARD,
      supportedTypes: [GatewayType.CREDIT_CARD, GatewayType.DEBIT_CARD],
      feePercent: 3.4,
      fixedFee: 0.30,
      currency: 'BRL',
      supportedCountries: ['BR', 'US', 'GB', 'CA', 'AU', 'DE', 'FR'],
      supportedCurrencies: ['BRL', 'USD', 'EUR', 'GBP', 'CAD', 'AUD'],
      websiteUrl: 'https://stripe.com/br',
      logoUrl: 'https://images.ctfassets.net/fzn2n1nzq965/HTTOloNPhisV9P4hlMPNA/cacf1bb88b9fc492dfad34378d844280/Stripe_icon_-_square.svg',
      feeStructure: {
        creditCard: { percent: 3.4, fixed: 0.30 },
        international: { percent: 1.0, fixed: 0.0 },
      },
    },
    {
      name: 'PayPal',
      slug: 'paypal',
      description: 'Gateway global - ideal para vendas internacionais',
      primaryType: GatewayType.PAYPAL,
      supportedTypes: [GatewayType.PAYPAL, GatewayType.CREDIT_CARD],
      feePercent: 4.4,
      fixedFee: 0.60,
      currency: 'BRL',
      supportedCountries: ['BR', 'US', 'GB', 'CA', 'AU', 'DE', 'FR'],
      supportedCurrencies: ['BRL', 'USD', 'EUR', 'GBP', 'CAD', 'AUD'],
      websiteUrl: 'https://www.paypal.com/br',
      logoUrl: 'https://www.paypalobjects.com/webstatic/mktg/Logo/pp-logo-200px.png',
      feeStructure: {
        paypal: { percent: 4.4, fixed: 0.60 },
        international: { percent: 6.4, fixed: 0.60 },
      },
    },
    {
      name: 'Cielo',
      slug: 'cielo',
      description: 'Uma das maiores adquirentes do Brasil',
      primaryType: GatewayType.CREDIT_CARD,
      supportedTypes: [
        GatewayType.CREDIT_CARD,
        GatewayType.DEBIT_CARD,
        GatewayType.PIX,
      ],
      feePercent: 3.25,
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR'],
      supportedCurrencies: ['BRL'],
      websiteUrl: 'https://www.cielo.com.br',
      feeStructure: {
        creditCard: { percent: 3.25, fixed: 0.0 },
        debitCard: { percent: 2.15, fixed: 0.0 },
        pix: { percent: 0.99, fixed: 0.0 },
      },
    },
    {
      name: 'Rede',
      slug: 'rede',
      description: 'Adquirente brasileira com foco em estabelecimentos f√≠sicos',
      primaryType: GatewayType.CREDIT_CARD,
      supportedTypes: [GatewayType.CREDIT_CARD, GatewayType.DEBIT_CARD],
      feePercent: 3.5,
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR'],
      supportedCurrencies: ['BRL'],
      websiteUrl: 'https://www.userede.com.br',
      feeStructure: {
        creditCard: { percent: 3.5, fixed: 0.0 },
        debitCard: { percent: 2.3, fixed: 0.0 },
      },
    },
    {
      name: 'GetNet',
      slug: 'getnet',
      description: 'Adquirente do Santander Brasil',
      primaryType: GatewayType.CREDIT_CARD,
      supportedTypes: [
        GatewayType.CREDIT_CARD,
        GatewayType.DEBIT_CARD,
        GatewayType.PIX,
      ],
      feePercent: 3.4,
      fixedFee: 0.0,
      currency: 'BRL',
      supportedCountries: ['BR'],
      supportedCurrencies: ['BRL'],
      websiteUrl: 'https://site.getnet.com.br',
      feeStructure: {
        creditCard: { percent: 3.4, fixed: 0.0 },
        debitCard: { percent: 2.2, fixed: 0.0 },
        pix: { percent: 0.99, fixed: 0.0 },
      },
    },
  ];

  // Salvar gateways
  for (const gatewayData of gateways) {
    const existing = await gatewayRepository.findOne({
      where: { slug: gatewayData.slug },
    });

    if (!existing) {
      const gateway = gatewayRepository.create(gatewayData);
      await gatewayRepository.save(gateway);
      console.log(`‚úÖ Gateway criado: ${gatewayData.name}`);
    }
  }

  console.log('üéâ Seed de presets conclu√≠do com sucesso!');
}